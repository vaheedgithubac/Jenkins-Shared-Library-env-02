@Library('Jenkins-Shared-Library-env-02') _

pipeline {
    agent any

    options { 
        skipDefaultCheckout true 
        disableConcurrentBuilds()
        timeout(time: 30, unit: 'MINUTES')
        timestamps() 
        ansiColor('xterm')                                  // plugin: "AnsiColor"
    }

    environment {
                      // Project Variables //
     PROJECT_NAME              = "myapp"                    // required
     PROJECT_KEY               = "myapp"                    // required
     COMPONENT                 = "backend"                  // required
        
                      // Git Variables //
     MY_GIT_URL                = "https://github.com/vaheedgithubac/DevOps-Project-Two-Tier-Flask-App.git"
     MY_GIT_REPO_TYPE          = "public"                   // required (public or private)
     MY_GIT_CREDENTIALS_ID     =  ""                        // required for private repos
     MY_GIT_BRANCH             = ""                         // Defaults to "main" if not set (here "" means jenkins treats as "null")
     // MY_GIT_LATEST_COMMIT_ID   = "null" //get_latest_short_commit()  // <-- calls call() from shared library
    }
    
    stages {
        stage ('GIT CHECKOUT') {
            steps {
                script {
                     gitCheckout()
                 }
             }
        }

        stage ('SET  env.MY_GIT_LATEST_COMMIT_ID') {
            steps {
                script {
                    env.MY_GIT_LATEST_COMMIT_ID = getLatestCommitIdShort()
                    echo "env.MY_GIT_LATEST_COMMIT_ID: ${env.MY_GIT_LATEST_COMMIT_ID}"
                }
            }
        }
    }
}
